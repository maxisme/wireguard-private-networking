[Interface]
Address = {{ wg_ip }}/32
PrivateKey = {{ private.content | b64decode | trim }}
{% if 'private_net' not in hostvars[node] %}
ListenPort = {{ wireguard_port }}
{% endif %}

{% for node in play_hosts %}
{% if inventory_hostname != hostvars[node]['inventory_hostname'] %}
[Peer]
PublicKey = {{ hostvars[node].public.content | b64decode | trim }}
AllowedIPs = {{ hostvars[node].wg_ip }}/32{% if 'private_ips' in hostvars[node] %},{{ hostvars[node]['private_ips']}}{% endif %}
{% if 'private_net' not in hostvars[node] %}
Endpoint = {{ hostvars[node]['ansible_host'] }}:{{ wireguard_port }}
{% endif %}
PersistentKeepalive = {{ PersistentKeepalive }}
{% endif %}

{% endfor %}